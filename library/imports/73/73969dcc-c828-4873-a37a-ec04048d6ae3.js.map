{"version":3,"sources":["../../../../assets/scripts/assets/scripts/BigWinEffect.js"],"names":["cc","Class","extends","Component","properties","nodeSpine","default","type","Node","title","labelCoin","Label","listTitle","SpriteFrame","coinBet","Integer","winParticle","ParticleSystem","btnReset","onLoad","anim_Appear","anim_Idle","skinAnim","listVictoryTarget","spine","getComponent","coinVictory","isTweening","showBigWinEffect","progress","value","update","log","string","formatMoney","uiUpdateWithTargetCoin","setUpInfo","targetIndex","coinAnim","node","opacity","seq","sequence","callFunc","setAnimation","runAction","fadeIn","animScaleNode","activeParticle","activeBtnReset","delayTime","countingCoin","active","stopSystem","resetSystem","component","dur","scale","repeatForever","scaleTo","num","tweenMoney","tween","to","delay","call","endBigWinEffect","start","length","updateTitle","setSkin","spawn","fadeOut","Sprite","spriteFrame","fasterEffect","stop","stopAction","sq","resetEffect","stopAllActions","setScale","Intl","NumberFormat","format","parseInt"],"mappings":"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","file":"BigWinEffect.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nodeSpine: {\n            default: null,\n            type: cc.Node\n        },\n\n        title: {\n            default: null,\n            type: cc.Node\n        },\n\n        labelCoin: {\n            default: null,\n            type: cc.Label\n        },\n\n        listTitle: {\n            default: [],\n            type: cc.SpriteFrame\n        },\n\n        coinBet: {\n            default: 0,\n            type: cc.Integer\n        },\n\n        winParticle: {\n            default: null,\n            type: cc.ParticleSystem\n        },\n\n        btnReset: {\n            default: null,\n            type: cc.Node\n        }\n    },\n\n    onLoad() {\n        this.anim_Appear = \"Appear\";\n        this.anim_Idle = \"Idle\";\n        this.skinAnim = [\"Frame_TLon\", \"Frame_TCLon\", \"Frame_TSLon\"];\n        this.listVictoryTarget = [this.coinBet * 20, this.coinBet * 50, this.coinBet * 80];\n        this.spine = this.nodeSpine.getComponent(\"sp.Skeleton\");\n        this.coinVictory = this.coinBet * 80;\n\n        this.isTweening = false;\n        this.showBigWinEffect();\n        this.progress = { value: 0 };\n    },\n    update() {\n        cc.log(\"progress: \" , this.progress.value, this.isTweening);\n        if (!this.isTweening) return;\n\n        this.labelCoin.string = this.formatMoney(this.progress.value) + \"\";\n        this.uiUpdateWithTargetCoin(this.progress.value);\n\n    },\n\n    setUpInfo() {\n        this.targetIndex = 1;\n        this.coinAnim = null;\n        this.labelCoin.string = \"0\";\n        this.labelCoin.node.opacity = 0;\n    },\n\n    showBigWinEffect() {\n        let seq = cc.sequence(\n            cc.callFunc(() => {\n                this.setUpInfo();\n                this.spine.setAnimation(0, this.anim_Appear, false);\n                this.labelCoin.node.runAction(cc.fadeIn(1.5));\n                this.animScaleNode(this.title, 0.4, 1.1);\n                this.animScaleNode(this.labelCoin.node, 0.2, 1.2);\n                this.activeParticle(true);\n                this.activeBtnReset(false);\n            }),\n            cc.delayTime(1.5),\n            cc.callFunc(() => {\n                this.spine.setAnimation(0, this.anim_Idle, true);\n                this.countingCoin(9);\n            })\n        );\n        this.node.runAction(seq);\n    },\n\n    activeParticle(active) {\n        if (!active) {\n            this.winParticle.node.opacity = 0;\n            this.winParticle.stopSystem();\n        } else {\n            this.winParticle.node.opacity = 255;\n            this.winParticle.resetSystem();\n        }\n    },\n\n    animScaleNode(component, dur, scale) {\n        let sequence = cc.repeatForever(cc.sequence(\n            cc.scaleTo(dur, scale),\n            cc.scaleTo(dur, 1),\n        ));\n        if (component === this.labelCoin.node)\n            this.coinAnim = sequence;\n        component.runAction(sequence);\n    },\n\n    countingCoin(num) {\n        this.isTweening = true;\n        this.tweenMoney = cc.tween(this.progress)\n            .to(num, { value: this.coinVictory })\n            .delay(0.1)\n            .call(() => {\n                this.labelCoin.string = this.formatMoney(this.coinVictory) + \"\";\n                this.endBigWinEffect();\n                this.tweenMoney = null;\n                this.isTweening = false;\n            }).start();\n    },\n\n    uiUpdateWithTargetCoin(progress) {\n        if (progress >= this.listVictoryTarget[this.targetIndex]) {\n            if (this.targetIndex > this.listVictoryTarget.length - 1) return;\n            this.updateTitle(this.targetIndex);\n            this.spine.setSkin(this.skinAnim[this.targetIndex]);\n            this.spine.setAnimation(0, this.anim_Idle, true);\n            this.targetIndex++;\n        }\n    },\n\n    updateTitle(num) {\n        var sequence = cc.sequence(\n            cc.spawn(\n                cc.scaleTo(0.3, 1.5),\n                cc.fadeOut(0.3)\n            ),\n            cc.callFunc(() => {\n                this.title.getComponent(cc.Sprite).spriteFrame = this.listTitle[num];\n            }),\n            cc.spawn(\n                cc.scaleTo(0.3, 1),\n                cc.fadeIn(0.3)\n            ),\n        );\n        this.title.runAction(sequence)\n    },\n\n    fasterEffect() {\n        if (this.targetIndex < 2)\n            this.targetIndex++;\n        if (this.tweenMoney) {\n            this.tweenMoney.stop();\n            this.tweenMoney = null;\n            this.countingCoin(2);\n        }\n    },\n\n    endBigWinEffect() {\n        this.labelCoin.node.stopAction(this.coinAnim);\n        this.activeParticle(false);\n        let sq = cc.sequence(\n            cc.delayTime(0.1),\n            cc.callFunc(() => {\n                this.isTweening = false;\n            }),\n            cc.delayTime(2),\n            cc.scaleTo(0.5, 0),\n            cc.callFunc(() => {\n                this.activeBtnReset(true);\n            })\n        )\n        this.node.runAction(sq)\n    },\n\n    activeBtnReset(active) {\n        this.btnReset.active = active;\n    },\n\n    resetEffect() {\n        this.spine.setSkin(this.skinAnim[0]);\n        this.title.getComponent(cc.Sprite).spriteFrame = this.listTitle[0];\n        this.node.stopAllActions();\n        this.node.setScale(1, 1);\n        this.progress.value = 0;\n        this.showBigWinEffect();\n        this.labelCoin.string = \"0\";\n    },\n\n    formatMoney(num) {\n        return Intl.NumberFormat('en-US').format(parseInt(num));\n    }\n\n\n});\n"]}